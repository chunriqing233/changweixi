<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>喵喵机</title> <link rel="apple-touch-icon" href="https://i.postimg.cc/rFC4dtSD/IMG-9981.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <div id="view-mode-toggle-btn" title="切换视图模式"><i class="fas fa-mobile-alt"></i></div>
    <div id="phone-screen">
        <div id="status-bar"><span id="status-bar-time"></span><div id="dynamic-island"><div class="island-content-wrapper"></div></div><div class="status-bar-right"><div class="signal-icon"><div class="bar bar1"></div><div class="bar bar2"></div><div class="bar bar3"></div><div class="bar bar4"></div></div><div class="battery-icon"><div class="battery-level"></div></div></div></div>
        <div id="message-context-menu"><div class="context-menu-item" id="context-menu-view">查看</div><div class="context-menu-item" id="context-menu-quote">引用</div><div class="context-menu-item" id="context-menu-regenerate">重置</div><div class="context-menu-item" id="context-menu-copy">复制</div><div class="context-menu-item" id="context-menu-edit">编辑</div><div class="context-menu-item" id="context-menu-multiselect">多选</div><div class="context-menu-item" id="context-menu-delete">删除</div></div>
        <div id="home-screen" class="screen active"><div id="new-decorative-widget"><div id="new-widget-bg" class="new-widget-part"></div><div id="new-widget-footer" class="new-widget-part"></div><div id="new-widget-avatar" class="new-widget-part"></div></div><div class="home-content-wrapper"><div class="home-widget-area" id="home-btn-main-hub"><div class="widget-placeholder"><img id="widget-main-image" src="https://i.postimg.cc/vDRCCNPZ/IMG-9985.png" style="width: 100%; height: 100%; border-radius: 22px; object-fit: cover;"></div><div class="widget-label">微信</div></div><div class="home-app-grid-area"><div class="app-icon" id="home-btn-ai-persona"><div id="icon-contacts" class="icon-bg">💬</div><div class="app-label">联系人</div></div><div class="app-icon" id="home-btn-my-persona"><div id="icon-me" class="icon-bg">🩹</div><div class="app-label">我</div></div><div class="app-icon" id="home-btn-settings"><div id="icon-settings" class="icon-bg">⚙️</div><div class="app-label">设置</div></div><div class="app-icon" id="home-btn-prompt"><div id="icon-prompt" class="icon-bg">💭</div><div class="app-label">提示词</div></div></div></div><div style="display: none;"><input type="file" id="new-bg-upload" accept="image/*"><input type="file" id="new-footer-upload" accept="image/*"><input type="file" id="new-avatar-upload" accept="image/*"></div><div class="home-dock-wrapper"><div class="app-icon" id="home-btn-music"><div id="icon-dock-1" class="icon-bg">🤍</div><div class="app-label">音乐</div></div><div class="app-icon"><div id="icon-dock-2" class="icon-bg">🩶</div><div class="app-label"></div></div><div class="app-icon"><div id="icon-dock-3" class="icon-bg">🖤</div><div class="app-label"></div></div></div></div>
        <div id="main-hub-screen" class="screen"><header id="main-hub-header" class="app-header"><button id="main-hub-back-btn" class="back-btn">‹</button><h2 id="main-hub-title">聊天</h2><div class="header-actions"><button id="main-hub-edit-btn" class="settings-btn" style="display: none;">编辑</button><button id="main-hub-add-btn" class="action-btn">+</button></div></header><div class="main-hub-content"><div id="hub-page-chat" class="hub-page active"><div id="chat-list-container" class="list-container"></div></div><div id="hub-page-contacts" class="hub-page"><div id="contacts-list-container" class="list-container"></div></div><div id="hub-page-moments" class="hub-page"><div id="moments-header"><img id="moments-cover-img" src=""><img id="moments-user-avatar" src=""><input type="file" id="moments-cover-upload" accept="image/*" style="display:none;"><input type="file" id="moments-avatar-upload" accept="image/*" style="display:none;"></div><div id="moments-feed"></div></div><div id="hub-page-me" class="hub-page"><div class="list-container" style="background-color: transparent; padding: 20px 0;"><div class="list-item" id="me-page-profile-item" style="cursor: pointer; background-color: var(--ai-bubble-bg); padding: 15px; margin: 0 15px 20px 15px; border-radius: 8px;"><div class="list-item-content" style="justify-content: space-between; align-items: flex-start;"><img id="me-page-avatar" class="list-item-avatar" style="width: 60px; height: 60px; margin-right: 15px;"><div class="list-item-info" style="gap: 6px;"><span id="me-page-name" class="list-item-name" style="font-size: 18px;"></span><span id="me-page-description" class="list-item-last-message"></span></div><span style="color: var(--system-message-color); font-size: 20px; align-self: center;">›</span></div></div></div></div></div><footer id="tab-bar"><div id="tab-btn-chat" class="tab-item active" data-title="聊天"><div class="icon">1</div><span class="tab-label">聊天</span></div><div id="tab-btn-contacts" class="tab-item" data-title="通讯录"><div class="icon">2</div><span class="tab-label">通讯录</span></div><div id="tab-btn-moments" class="tab-item" data-title="朋友圈"><div class="icon">2</div><span class="tab-label">朋友圈</span></div><div id="tab-btn-me" class="tab-item" data-title=""><div class="icon">2</div><span class="tab-label">我</span></div></footer></div>
        <div id="chat-screen" class="screen"><header class="app-header"><button id="chat-back-btn" class="back-btn">‹</button><h2 id="chat-title">聊天</h2><button id="chat-settings-btn" class="action-btn settings-btn" style="font-size: 16px;"> ... </button></header><div id="music-player-bar" style="display: none;"></div><div id="ai-status-bubble"></div><main class="chat-messages" id="chat-messages"></main><footer class="chat-input-area"><div id="edit-message-bar" style="display: none; padding: 8px; gap: 8px; align-items: center;"><textarea id="edit-message-input" rows="1" style="flex-grow: 1; border-radius: 5px; padding: 10px 15px; font-size: 15px; resize: none;"></textarea><div style="display: flex; flex-direction: column; gap: 5px;"><button id="save-edit-btn" class="save-btn" style="padding: 5px 12px; font-size: 14px; flex: none;">保存</button><button id="cancel-edit-btn" class="action-btn-secondary" style="padding: 5px 12px; font-size: 14px; flex: none;">取消</button></div></div><div id="reply-preview-container"><div id="reply-preview-bar"><div class="reply-preview-content"><span class="reply-to-author"></span><span class="reply-to-text"></span></div><button id="cancel-reply-btn">&times;</button></div></div><div class="chat-input-row"><input type="file" id="image-upload-input" accept="image/*" style="display: none;"><button id="toggle-actions-panel-btn"></button><textarea id="chat-input" placeholder="" rows="1"></textarea><button id="toggle-sticker-panel-btn" title="表情"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></button><button id="dynamic-action-btn"></button></div><div id="chat-actions-panel"><div class="actions-grid"><div id="action-send-image" class="action-grid-item"><div class="icon">📷</div><div class="label">相册</div></div><div id="action-start-videocall" class="action-grid-item"><div class="icon">📞</div><div class="label">视频通话</div></div><div id="action-send-location" class="action-grid-item"><div class="icon">🪨</div><div class="label">位置</div></div><div id="action-send-voice" class="action-grid-item"><div class="icon">🕸️</div><div class="label">语音</div></div><div id="action-send-image-text" class="action-grid-item"><div class="icon">♠️</div><div class="label">图片描述</div></div><div id="action-send-transfer" class="action-grid-item"><div class="icon">🎹</div><div class="label">转账</div></div><div id="action-listen-music" class="action-grid-item"><div class="icon">🎵</div><div class="label">一起听歌</div></div><div id="action-view-diary" class="action-grid-item"><div class="icon"></div><div class="label">查看随笔</div></div></div></div><div id="sticker-panel" class="chat-actions-panel"><div id="sticker-view-switcher" style="padding: 5px 15px 10px; text-align: center;"><div class="segmented-control" style="max-width: 250px; margin: 0 auto;"><button id="switch-to-my-stickers" class="segmented-control-button active">我的表情</button><button id="switch-to-ai-stickers" class="segmented-control-button">对方表情</button></div></div><div id="chat-sticker-grid-my"></div><div id="chat-sticker-grid-ai" style="display: none;"></div></div><div id="home-indicator-bar"></div></footer></div>
        <div id="public-account-screen" class="screen"><header class="app-header"><button id="public-account-back-btn" class="back-btn">‹</button><h2>公众号</h2></header><div id="public-account-feed" class="list-container" style="padding: 15px;"></div></div>
        <div id="videocall-screen" class="screen"><img id="videocall-bg-image" class="videocall-bg"><div class="videocall-overlay"><div id="videocall-my-preview"><img id="videocall-my-avatar"></div><div id="call-duration-timer">00:00</div><div id="videocall-messages"></div><div class="videocall-controls"><div class="videocall-main-actions"><div class="videocall-action-item"><div class="placeholder-action-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><path d="M12 19v4"></path><path d="M8 23h8"></path></svg></div><div class="action-label">扬声器</div></div><div class="videocall-action-item"><button id="videocall-hangup-btn"></button><div class="action-label">挂断</div></div><div class="videocall-action-item"><div class="placeholder-action-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></div><div class="action-label">切语音</div></div></div><div class="videocall-input-area"><input type="text" id="videocall-input" placeholder=""><button id="videocall-send-btn">发送</button></div></div></div></div>
        <div id="incoming-call-screen" class="screen"><div class="incoming-call-overlay"><div class="caller-info"><img id="incoming-call-avatar" class="caller-avatar" src=""><h3 id="incoming-call-name">AI 角色</h3><p id="incoming-call-reason">正在邀请你进行视频通话...</p></div><div class="call-actions"><div class="call-action-item"><button id="decline-call-btn" class="call-action-btn decline"><img src="https://i.postimg.cc/bNHGPnGM/IMG-5742.png" alt="拒绝来电"></button><span>拒绝</span></div><div class="call-action-item"><button id="accept-call-btn" class="call-action-btn accept"><img src="https://i.postimg.cc/pLLdt6Mh/IMG-5743.png" alt="接听来电"></button><span>接听</span></div></div></div></div>
        <div id="outgoing-call-screen" class="screen"><div class="incoming-call-overlay"><div class="caller-info"><img id="outgoing-call-avatar" class="caller-avatar" src=""><h3 id="outgoing-call-name">AI 角色</h3><p id="outgoing-call-status">正在呼叫...</p></div><div class="call-actions" style="justify-content: center;"><div class="call-action-item"><button id="cancel-outgoing-call-btn" class="call-action-btn decline"><img src="https://i.postimg.cc/bNHGPnGM/IMG-5742.png" alt="取消呼叫"></button><span>取消</span></div></div></div></div>
        <div id="call-log-screen" class="screen"><header class="app-header"><button id="call-log-back-btn" class="back-btn">‹</button><h2>通话记录</h2></header><div class="videocall-overlay" style="padding-top: 0;"><div id="call-log-messages" class="videocall-messages" style="justify-content: flex-start; padding: 15px; gap: 15px;"></div></div></div>
        <div id="ai-persona-list-screen" class="screen"><header class="app-header"><button id="ai-persona-list-back-btn" class="back-btn">‹</button><h2>AI 人设库</h2><div class="header-actions"><button id="ai-persona-edit-btn" class="settings-btn">编辑</button><button id="add-ai-persona-btn" class="action-btn">+</button></div></header><div class="list-container" id="ai-persona-list-container"></div></div>
        <div id="my-persona-list-screen" class="screen"><header class="app-header"><button id="my-persona-list-back-btn" class="back-btn">‹</button><h2>我的面具</h2><div class="header-actions"><button id="my-persona-edit-btn" class="settings-btn">编辑</button><button id="add-my-persona-btn" class="action-btn">+</button></div></header><div class="list-container" id="my-persona-list-container"></div></div>
        <div id="prompt-list-screen" class="screen"><header class="app-header"><button id="prompt-list-back-btn" class="back-btn">‹</button><h2>提示词库</h2><div class="header-actions"><button id="prompt-edit-btn" class="settings-btn">编辑</button><button id="add-prompt-btn" class="action-btn">+</button></div></header><div class="list-container" id="prompt-list-container"></div></div>
        <div id="sticker-screen" class="screen"><header class="app-header"><button id="sticker-screen-back-btn" class="back-btn">‹</button><h2>我的表情包</h2><button id="add-sticker-btn" class="settings-btn" style="font-size: 16px;">添加</button></header><div id="manage-sticker-grid" class="settings-page-content" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; justify-items: center; align-content: flex-start;"></div><input type="file" id="sticker-upload-input" accept="image/*" style="display: none;"></div>
        <div id="persona-editor-screen" class="screen"><header class="app-header"><button id="persona-editor-back-btn" class="back-btn">‹</button><h2 id="persona-editor-title">编辑预设</h2></header><div class="settings-page-content"><div class="form-group"><label for="preset-name-input">预设名称</label><input type="text" id="preset-name-input" placeholder="例如:图书馆魔法师"></div><div class="form-group"><label>Avatar</label><div> <img id="preset-avatar-preview" class="avatar-preview" src="" onclick="document.getElementById('preset-avatar-upload').click()" style="cursor: pointer;"> <button class="upload-btn" onclick="document.getElementById('preset-avatar-upload').click()">  </button><input type="file" id="preset-avatar-upload" accept="image/*" style="display:none;"></div></div><div class="form-group"><label for="preset-content-input">详细设定</label><textarea id="preset-content-input" rows="10" style="width:100%;padding:12px;border:1px solid var(--input-border);border-radius:8px;font-size:14px;box-sizing:border-box;"></textarea></div></div><div class="settings-actions"><button class="save-btn" id="start-chat-from-editor-btn">开始聊天</button><button id="set-primary-persona-btn" class="set-primary-btn">👑 设为主要形象</button><button class="action-btn-secondary" id="save-preset-btn">储存预设</button></div></div>
        <div id="prompt-editor-screen" class="screen"><header class="app-header"><button id="prompt-editor-back-btn" class="back-btn">‹</button><h2 id="prompt-editor-title">编辑提示词</h2></header><div class="settings-page-content"><div class="form-group"><label for="prompt-title-input">提示词标题 (方便自己识别)</label><input type="text" id="prompt-title-input" placeholder="例如：线上规则"></div><div class="form-group"><label for="prompt-content-input">提示词内容 (System Prompt)</label><textarea id="prompt-content-input" rows="15" placeholder="在这里输入详细的系统提示词..."></textarea></div></div><div class="settings-actions"><button class="save-btn" id="save-prompt-btn">储存提示词</button></div></div>
        <div id="create-chat-screen" class="screen"><header class="app-header"><button id="create-chat-back-btn" class="back-btn">‹</button><h2>建立新对话</h2></header><div class="settings-page-content"><div class="form-group"><label for="new-chat-name-input">备注</label><input type="text" id="new-chat-name-input" placeholder="给这个对话取个名字"></div><div class="form-group"><label>选择人物</label><div class="selection-box" id="select-new-ai-persona-btn"><span id="new-chat-ai-selection-text" class="placeholder">从人设库选择</span></div></div><div class="form-group"><label>选择我的面具</label><div class="selection-box" id="select-new-my-persona-btn"><span id="new-chat-my-selection-text" class="placeholder">从我的素材库选择</span></div></div></div><div class="settings-actions"><button class="save-btn" id="create-chat-btn">开始聊天</button></div></div>
        <div id="create-group-chat-screen" class="screen"><header class="app-header"><button id="create-group-chat-back-btn" class="back-btn">‹</button><h2>发起群聊</h2></header><div class="settings-page-content"><div class="form-group"><label for="group-chat-name-input">群聊名称</label><input type="text" id="group-chat-name-input" placeholder="给这个群聊取个名字"></div><div class="form-group"><label>选择我的面具</label><div class="selection-box" id="select-group-my-persona-btn"><span id="group-my-persona-selection-text" class="placeholder">从我的预设选择</span></div></div><div id="group-ai-persona-list-container" class="list-container" style="max-height: 500px;"></div></div><div class="settings-actions"><button class="save-btn" id="create-group-chat-btn">创建并开始聊天</button></div></div>
        <div id="create-post-screen" class="screen"><header class="app-header"><button id="cancel-post-btn" class="back-btn" style="font-size: 16px; font-weight: normal;">取消</button><h2>发表动态</h2><button id="send-post-btn" class="save-btn" style="padding: 5px 10px; font-size: 15px;">发表</button></header><div class="settings-page-content"><div class="form-group"><textarea id="post-text-input" rows="5" placeholder="此刻的想法..." style="border: none; outline: none;"></textarea></div><div class="form-group"><label for="post-image-text-input">配图想法 (多个请用逗号或中文逗号隔开)</label><input type="text" id="post-image-text-input" placeholder="例如：一只猫在睡觉,夕阳下的海滩"></div><div class="form-group"><label>位置</label><input type="text" id="post-location-input" placeholder="你的位置"></div></div></div>
        <div id="settings-hub-screen" class="screen"><header class="app-header"><button id="settings-hub-back-btn" class="back-btn">‹</button><h2>设置</h2></header><div class="settings-page-content"><div class="settings-section"><div id="settings-hub-api-btn" class="settings-item"><span class="item-label">API 设定</span><div class="item-value-container"><span class="disclosure-indicator">›</span></div></div></div><div class="settings-section"><div id="settings-hub-widget-btn" class="settings-item"><span class="item-label">小组件设定</span><div class="item-value-container"><span class="disclosure-indicator">›</span></div></div><div id="settings-hub-wallpaper-btn" class="settings-item"><span class="item-label">壁纸设定</span><div class="item-value-container"><span class="disclosure-indicator">›</span></div></div><div id="settings-hub-icon-btn" class="settings-item"><span class="item-label">app图标</span><div class="item-value-container"><span class="disclosure-indicator">›</span></div></div></div><div class="settings-section"><div class="settings-item"><span class="item-label">夜间模式</span><div id="settings-hub-dark-mode-toggle" class="toggle-switch"><div class="toggle-knob"></div></div></div><div class="settings-section"><div id="settings-hub-beautify-btn" class="settings-item"><span class="item-label">自定义美化</span><div class="item-value-container"><span class="disclosure-indicator">›</span></div></div></div></div><div class="settings-section"><div id="settings-hub-disclaimer-btn" class="settings-item"><span class="item-label">免责声明</span><div class="item-value-container"><span class="disclosure-indicator">›</span></div></div></div><div class="settings-section"><div id="export-data-btn" class="settings-item" style="cursor: pointer;"><span class="item-label" style="color: #007aff;">汇出全部资料</span></div><div id="import-data-btn" class="settings-item" style="cursor: pointer;"><span class="item-label" style="color: #007aff;">汇入备份档案</span></div></div><div id="donation-btn" style="text-align: center; margin-top: 30px; cursor: pointer;"><span>☕️ </span></div><input type="file" id="import-file-input" accept=".json,.txt" style="display: none;"></div></div>
        <div id="widget-settings-screen" class="screen"><header class="app-header" style="background-color: transparent; border-bottom: none; z-index: 10;"><button id="widget-settings-back-btn" class="back-btn" style="color: #000000;">‹</button><h2 style="color: #000000;">小组件设定</h2></header><div class="widget-settings-content"><div id="widget-preview-container"><div id="widget-preview-bg" class="new-widget-part"></div><div id="widget-preview-footer" class="new-widget-part"></div><div id="widget-preview-avatar" class="new-widget-part"></div></div><div id="widget-actions-container"><button id="change-widget-bg-btn" class="upload-btn">更换背景</button><button id="change-widget-footer-btn" class="upload-btn">更换页脚</button><button id="change-widget-avatar-btn" class="upload-btn">更换头像</button></div></div><div style="display: none;"><input type="file" id="widget-bg-upload-input" accept="image/*"><input type="file" id="widget-footer-upload-input" accept="image/*"><input type="file" id="widget-avatar-upload-input" accept="image/*"></div><div class="settings-actions"><button id="clear-all-widget-btn" class="action-btn-secondary">清除全部</button><button id="save-widget-settings-btn" class="save-btn">保存</button></div></div>
        <div id="chat-settings-screen" class="screen"><header class="app-header"><button id="chat-settings-back-btn" class="back-btn">‹</button><h2>对话设定</h2></header><div class="settings-page-content"><div class="settings-section"><div class="settings-item" id="settings-profile-item"><div class="item-value-container" style="gap: 15px;"><img id="settings-main-avatar" class="settings-profile-avatar" src=""><span id="settings-main-name" class="settings-profile-name"></span></div><span class="disclosure-indicator">›</span></div></div><div class="settings-section"><div id="select-ai-persona-btn" class="settings-item"><span class="item-label">AI 人物设定</span><div class="item-value-container"><span id="chat-ai-persona-selection-text"></span><span class="disclosure-indicator">›</span></div></div><div id="select-my-persona-btn" class="settings-item"><span class="item-label">我的角色设定</span><div class="item-value-container"><span id="chat-my-persona-selection-text"></span><span class="disclosure-indicator">›</span></div></div><div id="select-prompt-btn" class="settings-item"><span class="item-label">系统提示词</span><div class="item-value-container"><span id="chat-prompt-selection-text" class="placeholder">默认</span><span class="disclosure-indicator">›</span></div></div></div><div class="settings-section"><div class="settings-item"><label for="chat-name-input" class="item-label">对方备注</label><input type="text" id="chat-name-input"></div><div id="trigger-chat-wallpaper-upload" class="settings-item"><span class="item-label">聊天背景</span><div class="item-value-container"><span id="chat-wallpaper-status">未设置</span><span class="disclosure-indicator">›</span></div></div></div><div class="settings-section"><div class="settings-item"><span class="item-label">感知现实时间</span><div id="time-awareness-toggle" class="toggle-switch"><div class="toggle-knob"></div></div></div><div class="settings-item"><span class="item-label">线下阅读模式</span><div id="offline-mode-toggle" class="toggle-switch"><div class="toggle-knob"></div></div></div><div class="settings-item"><label for="chat-memory-rounds-input" class="item-label">记忆轮数</label><input type="number" id="chat-memory-rounds-input" min="0" value="0" style="width: 60px;"></div></div><div class="settings-section"><div class="settings-item"><span class="item-label">AI 主动搭话</span><div id="proactive-messaging-toggle" class="toggle-switch"><div class="toggle-knob"></div></div></div><div class="settings-item"><span class="item-label">主动搭话频率</span><div class="item-value-container"><div id="proactive-frequency-selector" class="segmented-control"><button class="segmented-control-button" data-value="60">低</button><button class="segmented-control-button" data-value="30">中</button><button class="segmented-control-button" data-value="10">高</button></div></div></div></div><input type="file" id="chat-wallpaper-upload" accept="image/*" style="display:none;"><div class="settings-section" id="block-contact-section"><div class="settings-item" id="block-contact-btn"><span class="item-label" style="color: #ff9500; text-align: center; width: 100%;">拉黑联系人</span></div></div><div class="settings-section" id="unblock-contact-section" style="display: none;"><div class="settings-item" id="unblock-contact-btn"><span class="item-label" style="color: #34c759; text-align: center; width: 100%;">解除拉黑</span></div></div><div class="settings-section" id="delete-contact-section" style="margin-top: 30px;"><div class="settings-item" id="delete-contact-btn"><span class="item-label" style="color: #ff3b30; text-align: center; width: 100%;">删除联系人</span></div></div></div><div class="settings-actions"><button class="save-btn" id="save-chat-settings-btn">储存设定</button></div></div>
        <div id="api-settings-screen" class="screen"><header class="app-header"><button id="api-settings-back-btn" class="back-btn">‹</button><h2>API 设定</h2></header><div class="settings-page-content"><div class="form-group"><label for="api-url-input">API (OpenAI 格式)</label><input type="text" id="api-url-input" placeholder="例如：https://api.openai.com/v1"></div><div class="form-group"><label for="api-key-input">API Key (金钥)</label><input type="password" id="api-key-input" placeholder="sk-..."></div><div class="form-group"><label for="api-model-input">API 模型名称</label><select id="api-model-select" style="display: none; margin-bottom: 8px;"></select><input type="text" id="api-model-input" placeholder="点击下方获取或手动输入"></div></div><div class="settings-actions"><button id="fetch-models-btn" class="fetch-btn">获取模型</button><button class="save-btn" id="save-api-btn">储存全部设定</button></div></div>
        <div id="home-settings-screen" class="screen"><header class="app-header"><button id="home-settings-back-btn" class="back-btn">‹</button><h2>壁纸设定</h2></header><div class="settings-page-content"><div class="form-group"><label>壁纸设定</label><div><img id="home-wallpaper-preview" class="wallpaper-preview" src="" alt=""><div class="wallpaper-actions"><button class="upload-btn" onclick="document.getElementById('home-wallpaper-upload').click()">更换背景</button><button id="clear-home-wallpaper-btn" class="upload-btn">清除背景</button></div><input type="file" id="home-wallpaper-upload" accept="image/*" style="display:none;"></div></div></div><div class="settings-actions"><button id="save-home-settings-btn" class="save-btn">储存设定</button></div></div>
        <div id="icon-settings-screen" class="screen"><header class="app-header"><button id="icon-settings-back-btn" class="back-btn">‹</button><h2>app图标</h2></header><div class="settings-page-content"><p style="text-align: center; color: var(--system-message-color); font-size: 13px; padding: 0 20px 10px;">点击下方的图示，即可更换图片。</p><div id="icon-grid-container" class="actions-grid" style="padding: 15px; gap: 20px;"></div></div><input type="file" id="icon-upload-input" accept="image/*" style="display: none;"><div class="settings-actions" style="padding: 15px 35px 40px 35px;"><button id="cancel-icon-changes-btn" class="action-btn-secondary">清除全部</button><button id="save-icon-changes-btn" class="save-btn">保存全部图示</button></div></div>
        <div id="persona-selection-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><header class="app-header" style="border-bottom: 1px solid #eee; padding-left:0; padding-right: 0;"><h2 id="persona-selection-modal-title" style="position: static; transform: none;">选择一个预设</h2></header><div class="list-container" id="modal-persona-list" style="max-height: 400px;"></div><div class="settings-actions" style="border-top: 1px solid #eee; padding: 15px 0 0 0;"><button id="cancel-selection-btn" class="action-btn-secondary">取消</button><button id="save-selection-btn" class="save-btn">储存</button></div></div></div>
        <div id="select-chat-for-moment-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><header class="app-header" style="border-bottom: 1px solid #eee; padding-left:0; padding-right: 0;"><h2 style="position: static; transform: none;">选择对话生成动态</h2></header><div class="list-container" id="modal-chat-list"></div><div class="settings-actions" style="border-top: 1px solid #eee; padding: 15px 0 0 0;"><button id="cancel-chat-selection-btn" class="action-btn-secondary" style="width: 100%;">取消</button></div></div></div>
        <div id="create-new-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: flex-end; align-items: center; z-index: 110;"><div class="modal-box" style="width: 100%; border-radius: 12px 12px 0 0; margin-bottom: -20px; padding: 10px;"><div class="list-container" style="background: transparent;"><div id="modal-btn-new-chat" class="list-item" style="text-align: center; display: block; cursor: pointer; padding: 15px;"><span class="list-item-name">新增对话框</span></div><div id="modal-btn-new-group" class="list-item" style="text-align: center; display: block; cursor: pointer; padding: 15px;"><span class="list-item-name">发起群聊</span></div><div id="modal-btn-add-contact" class="list-item" style="text-align: center; display: block; cursor: pointer; padding: 15px;"><span class="list-item-name">添加联系人</span></div></div><div class="settings-actions" style="padding: 10px 0 20px 0;"><button id="modal-btn-cancel-create" class="action-btn-secondary" style="width: 100%;">取消</button></div></div></div>
        <div id="moments-action-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: flex-end; align-items: center; z-index: 110;"><div class="modal-box" style="width: 100%; border-radius: 12px 12px 0 0; margin-bottom: -20px; padding: 10px;"><div class="list-container" style="background: transparent;"><div id="modal-btn-post-my-moment" class="list-item" style="text-align: center; display: block; cursor: pointer; padding: 15px;"><span class="list-item-name">发表朋友圈</span></div><div id="modal-btn-generate-ai-moment" class="list-item" style="text-align: center; display: block; cursor: pointer; padding: 15px;"><span class="list-item-name">查看最近朋友圈</span></div></div><div class="settings-actions" style="padding: 10px 0 20px 0;"><button id="modal-btn-cancel-moments-action" class="action-btn-secondary" style="width: 100%;">取消</button></div></div></div>
        <div id="location-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><h3>发送位置</h3><div class="form-group"><input type="text" id="location-input-text" placeholder="输入地址..."></div><div class="settings-actions"><button id="cancel-location-btn" class="action-btn-secondary">取消</button><button id="send-location-btn" class="save-btn">发送</button></div></div></div>
        <div id="voice-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><h3>录入语音文字</h3><div class="form-group"><textarea id="voice-input-text" rows="5" placeholder="请输入语音 ..."></textarea></div><div class="settings-actions"><button id="cancel-voice-btn" class="action-btn-secondary">取消</button><button id="send-voice-btn" class="save-btn">发送</button></div></div></div>
        <div id="image-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><h3>输入图片内容</h3><div class="form-group"><input type="text" id="image-input-text" placeholder="输入图片ID或内容..."></div><div class="settings-actions"><button id="cancel-image-btn" class="action-btn-secondary">取消</button><button id="send-image-btn" class="save-btn">发送</button></div></div></div>
        <div id="transfer-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><h3>微信转账</h3><div class="form-group"><label for="transfer-amount-input">转账金额</label><input type="number" id="transfer-amount-input" placeholder="￥0.00"></div><div class="form-group"><label for="transfer-remark-input">备注 (可不填)</label><input type="text" id="transfer-remark-input" placeholder="给对方的留言"></div><div class="settings-actions"><button id="cancel-transfer-btn" class="action-btn-secondary">取消</button><button id="send-transfer-btn" class="save-btn">转账</button></div></div></div>
        <div id="custom-confirm-modal" class="screen" style="background: rgba(0,0,0,0.6); justify-content: center; align-items: center; display: none;"><div class="modal-box"><h3 id="custom-confirm-title" style="text-align: center;">确定操作</h3><p id="custom-confirm-text" style="text-align: center; margin: 20px 0; line-height: 1.5;"></p><div class="settings-actions"><button id="custom-confirm-cancel-btn" class="action-btn-secondary">取消</button><button id="custom-confirm-ok-btn" class="save-btn" style="background-color: var(--delete-bg);">确定</button></div></div></div>
        <div id="music-player-screen" class="screen"><header class="app-header"><button id="music-player-back-btn" class="back-btn">‹</button><h2>正在播放</h2><div class="header-actions"><button id="import-playlist-btn" class="settings-btn" style="font-size: 14px; font-weight: normal;">导入歌单</button><button id="select-contact-for-music-btn" class="action-btn" style="font-weight: 500;">+</button></div></header><div id="music-session-avatars"><img id="music-my-avatar" class="session-avatar"><img id="music-partner-avatar" class="session-avatar"></div><div id="player-album-art-container"><div class="album-art-area"><div class="album-cover"><img id="player-album-art" src="https://i.postimg.cc/d1sY31J7/music-placeholder.png" alt="Album Art"></div><div class="vinyl" id="vinyl-disc"><div class="vinyl-label"><img id="vinyl-label-img" src="https://i.postimg.cc/d1sY31J7/music-placeholder.png" alt="Vinyl Label"></div></div></div></div><div id="player-song-info"><h3 id="player-song-title">未在播放</h3><p id="player-song-artist">请添加歌曲</p></div><div id="player-lyrics-container"><div id="player-lyrics-content"><p class="lyric-line">...</p></div></div><div id="player-progress-container"><span id="player-current-time">0:00</span><input type="range" id="player-progress-bar" value="0" step="1" min="0" max="100"><span id="player-duration">0:00</span></div><div class="player-buttons"><i class="fas fa-repeat" id="player-mode-btn" title="循环模式"></i><i class="fas fa-step-backward" id="player-prev-btn"></i><i class="fas fa-play-circle" id="player-play-pause-btn"></i><i class="fas fa-step-forward" id="player-next-btn"></i><i class="fas fa-list-ul" id="player-playlist-btn" title="播放列表"></i></div><div id="diary-modal" class="screen" style="display: none; z-index: 150;"><div id="diary-text-container"></div><button id="close-diary-modal-btn" class="save-btn">关闭</button></div><div id="playlist-sheet-overlay"></div><div id="playlist-sheet"><div class="playlist-header"><div class="handle-bar"></div><h3>播放列表</h3></div><ul id="playlist-content"></ul></div></div>
        <div id="donation-modal" class="screen" style="background: rgba(0,0,0,0.6); justify-content: center; align-items: center; display: none; z-index: 250;"><div id="donation-image-container" style="padding: 10px; background: white; border-radius: 12px;"><img src="https://i.postimg.cc/15XLzBHS/IMG-0693.jpg" style="max-width: 80vw; max-height: 80vh; display: block; border-radius: 8px;"></div></div>
        <div id="disclaimer-screen" class="screen"><header class="app-header"><button id="disclaimer-back-btn" class="back-btn">‹</button><h2>免责声明</h2></header><div class="settings-page-content"><div class="disclaimer-text-container"><p>本网页仅供个人学习和娱乐，所有聊天内容、朋友圈、通话记录等均为虚拟生成，不代表任何真实人物、事件或观点。</p><p>用户生成和使用的所有AI角色设定、对话、图片等内容的责任由用户自行承担。</p><p>请勿将本网页用于任何非法或侵犯他人权益的用途。开发者不对因使用本应用而产生的任何直接或间接后果负责。</p><p>作者：长尾蜥   网页名：喵喵机   禁止任何二传二改，本网页唯一获取途径QQ群：1048686068</p><p>邮箱留言：2768107102@qq.com</p><p> =^._.^= </p></div></div></div>
        <div id="donation-page-screen" class="screen"><header class="app-header"><button id="donation-page-back-btn" class="back-btn">‹</button><h2>支持开发者</h2></header><div class="settings-page-content"><div id="donation-qr-container"><p style="color: var(--system-message-color); margin-bottom: 20px;">如果觉得这个应用有趣，可以请我喝杯咖啡☕️</p><img src="https://i.postimg.cc/15XLzBHS/IMG-0693.jpg" alt="Donation QR Code"><p style="color: var(--system-message-color); font-size: 14px; margin-top: 20px;">感谢您的支持！</p></div></div></div>
        <div id="sticker-name-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><h3>为表情命名</h3><div class="form-group"><label for="sticker-name-input">表情内容 (AI会读取这段文字)</label><input type="text" id="sticker-name-input" placeholder="例如：猫猫探头.gif"></div><div class="settings-actions"><button id="cancel-sticker-name-btn" class="action-btn-secondary">取消</button><button id="save-sticker-name-btn" class="save-btn">保存</button></div></div></div>
        <div id="music-selection-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><h3>一起听歌</h3><div class="form-group"><label for="music-song-input">歌曲名</label><input type="text" id="music-song-input" placeholder="例如：晴天"></div><div class="form-group"><label for="music-artist-input">歌手</label><input type="text" id="music-artist-input" placeholder="例如：周杰伦"></div><div class="form-group"><label for="music-url-input">歌曲 URL (需为 .mp3 等直接链接)</label><input type="text" id="music-url-input" placeholder="https://..."></div><div class="settings-actions"><button id="cancel-music-selection-btn" class="action-btn-secondary">取消</button><button id="start-music-session-btn" class="save-btn">开始播放</button></div></div></div>
        <div id="select-contact-for-music-modal" class="screen" style="background: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 100;"><div class="modal-box"><header class="app-header" style="border-bottom: 1px solid #eee; padding-left:0; padding-right: 0;"><h2 style="position: static; transform: none;">选择一起听歌的人</h2></header><div class="list-container" id="modal-music-contact-list" style="max-height: 400px;"></div><div class="settings-actions" style="border-top: 1px solid #eee; padding: 15px 0 0 0; flex-direction: column;"><button id="modal-btn-end-music-session-from-player" class="save-btn" style="background-color: #ff3b30;">退出一起听歌</button><button id="cancel-music-contact-selection-btn" class="action-btn-secondary" style="width: 100%; margin-top: 10px;">取消</button></div></div></div>
        <div id="custom-beautification-screen" class="screen"><header class="app-header"><button id="custom-beautification-back-btn" class="back-btn">‹</button><h2>自定义美化</h2><button id="toggle-preview-fullscreen-btn" class="settings-btn"><i class="fas fa-expand"></i></button></header><div class="settings-page-content" style="padding: 20px 15px;"><div class="form-group"><label>效果预览</label><div id="beautify-preview"><div id="preview-phone-screen-container"><div class="app-header" style="position: static; padding-top: 10px; height: auto;"><button class="back-btn">‹</button><h2 style="position: static; transform: none;">预览</h2><button class="action-btn settings-btn" style="font-size: 16px;"> ... </button></div><div id="preview-messages-container" class="preview-messages"></div><div class="preview-chat-footer-wrapper"><div class="chat-input-row"><button id="preview-plus-btn" class="toggle-actions-panel-btn"></button><textarea id="preview-chat-input" rows="1"></textarea><button id="preview-emoji-btn" class="toggle-sticker-panel-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></button><button id="preview-dynamic-btn" class="dynamic-action-btn"></button></div></div></div></div><div class="form-group"><label for="custom-font-url-input">自定义字体链接 (.ttf)</label><input type="text" id="custom-font-url-input" placeholder="输入 .ttf 字体文件的 URL"></div><div class="form-group"><label for="global-font-size-slider">全局字体大小: <span id="font-size-value">16px</span></label><input type="range" id="global-font-size-slider" min="12" max="20" step="0.5" value="16" style="width: 100%;"></div><div class="form-group"><label>聊天气泡大小</label><div id="bubble-size-selector" class="segmented-control" style="width: 100%;"><button class="segmented-control-button" data-size="small">小</button><button class="segmented-control-button active" data-size="medium">中 (默认)</button><button class="segmented-control-button" data-size="large">大</button></div></div><div class="form-group"><label>全局默认背景</label><div class="wallpaper-actions"><span id="default-bg-status" class="item-value-status">未设置</span><div><button class="upload-btn" id="change-default-bg-btn">更换</button><button class="upload-btn" id="clear-default-bg-btn">清除</button></div></div></div><div class="form-group"><label>顶部栏 (Header)</label><div class="wallpaper-actions"><span id="top-bar-status" class="item-value-status">未设置</span><div><button class="upload-btn" id="change-top-bar-btn">更换</button><button class="upload-btn" id="clear-top-bar-btn">清除</button></div></div></div><div class="form-group"><label>底部栏/输入区</label><div class="wallpaper-actions"><span id="bottom-bar-status" class="item-value-status">未设置</span><div><button class="upload-btn" id="change-bottom-bar-btn">更换</button><button class="upload-btn" id="clear-bottom-bar-btn">清除</button></div></div></div><div style="display: none;"><input type="file" id="default-bg-upload" accept="image/*"><input type="file" id="top-bar-upload" accept="image/*"><input type="file" id="bottom-bar-upload" accept="image/*"></div><div class="form-group"><label for="custom-css-input">自定义气泡样式 (CSS)</label><textarea id="custom-css-input" rows="10" placeholder="在这里粘贴你的 CSS 代码... 例如:&#10;.message-bubble.user .content { background: linear-gradient(to right, #6a11cb, #2575fc); color: white; }"></textarea></div></div><div class="form-group"><label for="custom-global-css-input">全局界面样式 (CSS)</label><textarea id="custom-global-css-input" rows="10" placeholder="自定义其他部分的样式，例如：&#10;.app-header { border-radius: 0 !important; } &#10;#home-screen { padding-top: 120px; }"></textarea></div><div class="settings-actions" style="padding: 15px 20px 40px 20px; display: flex; gap: 10px;"><button class="action-btn-secondary" id="import-theme-btn" style="flex: 1;">导入主题</button><button class="action-btn-secondary" id="export-theme-btn" style="flex: 1;">导出主题</button><button class="save-btn" id="save-beautification-btn" style="flex: 2;">保存并应用</button></div><input type="file" id="theme-import-input" accept=".zip" style="display: none;"></div>
        <audio id="global-audio-player" style="display: none;"></audio>
        <div id="import-modal-overlay" class="modal-overlay"><div class="modal-content"><h3>导入网易云歌单</h3><p>请粘贴歌单的分享链接或ID</p><input type="text" id="playlist-url-input" placeholder="http://163cn.tv/..."><div class="modal-buttons"><button id="cancel-import-playlist">取消</button><button id="confirm-import-playlist" disabled>导入</button></div></div></div>
        <div id="beautify-preview-modal" class="modal-overlay"><div id="preview-phone-screen-container"><div class="preview-header"><span>‹</span><span style="font-weight: 600;">预览</span><span>...</span></div><div class="preview-messages"><div class="message-wrapper ai"><img class="avatar" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAARFJREFUeJzt2LEJACEMxEAJ//9/dk8eEMVpU2ecK5eCynLpdDrdz+c55/vnaa3dD5/b2Wtrj/ZgB/ZgB/ZgB/ZgB/bAJ1hrf4s0n2vZTb8d2IMd2IMd2IMd2IMd2IE/sLZe7WubXw/swQ7swQ7swQ7swQ7swR/Y2trZDuxhD3ZgB3ZgB3ZgB3ZgB/ZgB3ZgB3ZgB3ZgB3bA9g7swQ7swQ7swQ7swQ7sAR/Y2tpu9b/ZvwN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN/fAERpA3b/e8YAgAAAABJRU5ErkJggg=="><div class="message-bubble ai"><div class="content">你好，这是 AI 消息。</div></div></div><div class="message-wrapper user"><div class="message-bubble user"><div class="content">这是你发送的消息。</div></div></div><div class="message-wrapper ai"><img class="avatar" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAARFJREFUeJzt2LEJACEMxEAJ//9/dk8eEMVpU2ecK5eCynLpdDrdz+c55/vnaa3dD5/b2Wtrj/ZgB/ZgB/ZgB/ZgB/bAJ1hrf4s0n2vZTb8d2IMd2IMd2IMd2IMd2IE/sLZe7WubXw/swQ7swQ7swQ7swQ7swR/Y2trZDuxhD3ZgB3ZgB3ZgB3ZgB/ZgB3ZgB3ZgB3ZgB3bA9g7swQ7swQ7swQ7swQ7sAR/Y2tpu9b/ZvwN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN7sAN/fAERpA3b/e8YAgAAAABJRU5ErkJggg=="><div class="message-bubble ai"><div class="content">在这里预览你的美化效果。</div></div></div></div><div class="preview-footer"><div class="input-placeholder"></div><div class="send-placeholder"></div></div><button id="close-beautify-preview-btn">&times;</button></div></div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  
   <script src="script.js" defer></script>


</body>
</html>